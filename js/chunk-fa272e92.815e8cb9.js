(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fa272e92"],{"09db":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var o=n("9bd2");function r(t){return Object(o["a"])({url:"/admin/userAddSite",method:"post",data:t})}},4520:function(t,e,n){"use strict";var o=n("498b"),r=n.n(o);r.a},"498b":function(t,e,n){},c790:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var o=n("9bd2");function r(t){return Object(o["a"])({url:"/user/list?page=".concat(t),method:"get",withCredentials:!0})}},cdaf:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("d2-container",[n("template",{slot:"header"},[n("strong",{staticStyle:{"font-size":"28px"}},[t._v(" 【"+t._s(t.siteurl)+"】的站点授权管理")])]),n("d2-crud",{ref:"d2Crud",attrs:{pagination:t.pagination,columns:t.columns,data:t.data.filter((function(e){return!t.search||e.username.toLowerCase().includes(t.search.toLowerCase())})),"edit-title":"站点授权管理","form-options":t.formOptions},on:{"pagination-current-change":t.paginationCurrentChange}},[n("el-input",{staticStyle:{"margin-bottom":"6px"},attrs:{slot:"header",placeholder:"输入用户名搜索"},slot:"header",model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)],2)},r=[],i=(n("99af"),n("4de4"),n("a9e3"),n("e25e"),n("c790")),c=n("9bd2");function a(t){return Object(c["a"])({url:"/admin/viewManager",method:"post",data:t})}var s=n("c276"),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{cursor:"pointer"}},[n("el-tag",{attrs:{type:t.type},nativeOn:{click:function(e){return t.handleClick(e)}}},[t._v(t._s(t.text))])],1)},l=[],p=n("09db");function f(t){return Object(c["a"])({url:"/admin/userDelSite",method:"post",data:t})}var h={data:function(){return{}},props:{scope:{default:null},myProps:{default:null}},computed:{type:function(){return this.scope.row.webstatus?"success":"danger"},text:function(){return this.scope.row.webstatus?"已授权":"未授权"}},mounted:function(){},methods:{handleClick:function(){var t=this,e=this.$createElement,n=this,o=this.scope.row.realName||this.scope.row.username,r=this.type;if("success"===r){var i="你正在解除【".concat(o,"】\n        对【").concat(this.scope.row.siteurl,"】的授权行为，\n        解除授权之后该用户将无法操作该网站，你确定要这么做吗？"),c="你已成功\n        解除【".concat(this.scope.row.realName,"】\n        对【").concat(this.scope.row.siteurl,"】的授权");this.$confirm(i,"解除授权",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){f(t.scope.row).then((function(t){n.scope.row.webstatus=0})).catch((function(e){console.log("err",e),t.loading=!1,t.$notify({message:"接口失败"})})),t.$notify({title:"解除授权成功",duration:6e3,type:"error",message:e("b",{style:"color: teal"},c)})})).catch((function(){}))}else{var a="你正在启用【".concat(o,"】\n        对【").concat(this.scope.row.siteurl,"】的授权行为，\n        启用授权之后该用户将获得该网站的操作权限，你确定要这么做吗"),s="你已成功\n        启用【".concat(this.scope.row.realName,"】\n        对【").concat(this.scope.row.siteurl,"】的授权");this.$confirm(a,"启用授权",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(p["a"])(t.scope.row).then((function(o){n.scope.row.webstatus=1,t.$notify({title:"启用授权成功",duration:6e3,type:"success",message:e("b",{style:"color: teal"},s)})})).catch((function(e){console.log("err",e),t.loading=!1,t.$notify({message:"接口失败"})}))})).catch((function(){}))}}}},d=h,g=n("0c7c"),m=Object(g["a"])(d,u,l,!1,null,null,null),w=m.exports,y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{cursor:"pointer"}},[n("el-tag",{attrs:{type:t.type},nativeOn:{click:function(e){return t.handleClick(e)}}},[t._v(t._s(t.text))])],1)},b=[],v={data:function(){return{}},props:{scope:{default:null},myProps:{default:null}},computed:{type:function(){return this.scope.row.origincheck?"success":"danger"},text:function(){return this.scope.row.origincheck?"已授权":"未授权"}},mounted:function(){},methods:{handleClick2:function(){},handleClick:function(){var t=this,e=this.$createElement,n=this,o=this.scope.row.realName||this.scope.row.username,r=this.type;if("success"===r){var i="你正在解除【".concat(o,"】\n        对【").concat(this.scope.row.siteurl,"】的专属授权行为，\n        解除之后站点信息会同步注销该用户信息，你确定要这么做吗？"),c="你已成功\n        解除【".concat(this.scope.row.realName,"】\n        对【").concat(this.scope.row.siteurl,"】的授权");this.$confirm(i,"解除授权",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.scope.row.origincheckok=1,f(t.scope.row).then((function(t){n.scope.row.origincheck=!1})).catch((function(e){console.log("err",e),t.loading=!1,t.$notify({message:"接口失败"})})),t.$notify({title:"解除授权成功",duration:6e3,type:"error",message:e("b",{style:"color: teal"},c)})})).catch((function(){}))}else{var a="【".concat(this.scope.row.siteurl,"】是否是\n        【").concat(o,"】【").concat(this.scope.row.company,"】客户的站点？\n        执行该操作之后站点信息(所属和公司名)会同步更新为该客户信息，你确定要这么做吗"),s="你已成功\n        启用【".concat(o,"】\n        对【").concat(this.scope.row.siteurl,"】的专属授权");this.$confirm(a,"专属授权",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.scope.row.origincheckok=1,Object(p["a"])(t.scope.row).then((function(o){n.scope.row.origincheck=!0,t.$notify({title:"启用授权成功",duration:6e3,type:"success",message:e("b",{style:"color: teal"},s)})})).catch((function(e){console.log("err",e),t.loading=!1,t.$notify({message:"接口失败"})}))})).catch((function(){}))}}}},k=v,x=Object(g["a"])(k,y,b,!1,null,null,null),$=x.exports,O={name:"webcontrol",components:{},data:function(){return{sitey:{siteid:this.$route.params.id},siteurl:this.$route.params.url,search:"",pagination:{currentPage:1,pageSize:15,total:0},columns:[{title:"账号",key:"username"},{title:"真实姓名",key:"realName"},{title:"公司",key:"company",width:300},{title:"普通授权",key:"webstatus",width:"100",component:{name:w,props:{myProps:""}},filters:[{text:"已授权",value:1},{text:"未授权",value:0}],filterMethod:function(t,e){return Number(e.webstatus)===t},filterPlacement:"bottom-end"},{title:"所属授权",key:"origincheckok",width:"100",component:{name:$,props:{myProps:""}},filters:[{text:"已授权",value:!0},{text:"未授权",value:!1}],filterMethod:function(t,e){return e.origincheckok===t},filterPlacement:"bottom-end"},{title:"用户电话",key:"tel"},{title:"所属组",key:"group",filters:[{text:"客户",value:"客户"},{text:"代理",value:"代理"},{text:"客服",value:"客服"}],filterMethod:function(t,e){return e.group===t},filterPlacement:"bottom-end"}],data:[],formOptions:{labelWidth:"100px",labelPosition:"left",saveLoading:!1}}},mounted:function(){void 0===this.siteurl&&this.$router.push({name:"index"}),this.fetchData()},methods:{fetchData:function(){var t=this,e=s["a"].cookies.get("group");this.loading=!0,Object(i["a"])(this.pagination.currentPage).then((function(n){var o=n.data;t.pagination.total=n.total,a(t.sitey).then((function(n){for(var r=n,i=o.filter((function(t){return r.some((function(e){return null!==e.origin&&parseInt(e.origin)===t.id}))})),c=o.filter((function(t){return r.some((function(e){return e.userid===t.id&&parseInt(e.origin)!==t.id}))})),a=o.filter((function(t){return!r.some((function(e){return e.userid===t.id}))})),s=0;s<i.length;s++)i[s].siteid=t.sitey.siteid,i[s].userid=i[s].id,i[s].siteurl=t.siteurl,i[s].origincheck=!0,null===i[s].group||0===i[s].group?"null"===String(e)||0===Number(e)?i[s].group="管理员":delete i[s]:1===i[s].group?i[s].group="客户":2===i[s].group?i[s].group="代理":3===i[s].group&&(i[s].group="客服");for(var u=0;u<c.length;u++)c[u].origincheck=!1,c[u].siteid=t.sitey.siteid,c[u].userid=c[u].id,c[u].siteurl=t.siteurl,c[u].webstatus=1,null===c[u].group||0===c[u].group?"null"===String(e)||0===Number(e)?c[u].group="管理员":delete c[u]:1===c[u].group?c[u].group="客户":2===c[u].group?c[u].group="代理":3===c[u].group&&(c[u].group="客服");for(var l=0;l<a.length;l++)a[l].origincheck=!1,a[l].siteid=t.sitey.siteid,a[l].userid=a[l].id,a[l].siteurl=t.siteurl,a[l].webstatus=0,null===a[l].group||0===a[l].group?"null"===String(e)||0===Number(e)?a[l].group="管理员":delete a[l]:1===a[l].group?a[l].group="客户":2===a[l].group?a[l].group="代理":3===a[l].group&&(a[l].group="客服");var p=i.concat(c),f=p.concat(a);t.data=f})),t.loading=!1})).catch((function(e){console.log("err",e),t.loading=!1,t.$notify({message:"获取数据失败"})}))},paginationCurrentChange:function(t){this.pagination.currentPage=t,this.fetchData()}}},C=O,_=(n("4520"),Object(g["a"])(C,o,r,!1,null,"3410af7d",null));e["default"]=_.exports},e25e:function(t,e,n){var o=n("23e7"),r=n("e583");o({global:!0,forced:parseInt!=r},{parseInt:r})},e583:function(t,e,n){var o=n("da84"),r=n("58a8").trim,i=n("5899"),c=o.parseInt,a=/^[+-]?0[Xx]/,s=8!==c(i+"08")||22!==c(i+"0x16");t.exports=s?function(t,e){var n=r(String(t));return c(n,e>>>0||(a.test(n)?16:10))}:c}}]);